

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>hio.base.doing &mdash; hio 0.3.4 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> hio
          

          
          </a>

          
            
            
              <div class="version">
                0.3.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">Introduction to HIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">src</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/index.html">API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">hio</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../hio.html">hio</a> &raquo;</li>
        
      <li>hio.base.doing</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for hio.base.doing</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- encoding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">hio.core.doing Module</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">isgeneratorfunction</span><span class="p">,</span> <span class="n">ismethod</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span><span class="p">,</span> <span class="n">namedtuple</span>

<span class="kn">from</span> <span class="nn">..hioing</span> <span class="kn">import</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">VersionError</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">hioing</span>
<span class="kn">from</span> <span class="nn">.basing</span> <span class="kn">import</span> <span class="n">State</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">tyming</span>
<span class="kn">from</span> <span class="nn">..core.tcp</span> <span class="kn">import</span> <span class="n">serving</span><span class="p">,</span> <span class="n">clienting</span>
<span class="kn">from</span> <span class="nn">..help</span> <span class="kn">import</span> <span class="n">timing</span><span class="p">,</span> <span class="n">helping</span>


<div class="viewcode-block" id="Deed"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.Deed">[docs]</a><span class="n">Deed</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;Deed&quot;</span><span class="p">,</span> <span class="s2">&quot;dog retyme index&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Doist"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.Doist">[docs]</a><span class="k">class</span> <span class="nc">Doist</span><span class="p">(</span><span class="n">tyming</span><span class="o">.</span><span class="n">Tymist</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Doist is the root coroutine scheduler</span>
<span class="sd">    Provides relative cycle time in seconds with .tyme property to doers it runs</span>
<span class="sd">    The relative cycle time is advanced in .tock size increments by the  by  the</span>
<span class="sd">    .tick method.</span>
<span class="sd">    The doist may treat .tyme as artificial time or synchonize it to real time.</span>

<span class="sd">    .ready method prepares deeds deque of triples (dog, retyme, index) where</span>
<span class="sd">        dog is a doer generator returned by calling doer generator instances,</span>
<span class="sd">        functions, or methods.</span>

<span class="sd">    .once method runs its deeds deque of triples (dog, retyme, index) once per</span>
<span class="sd">        invocation.</span>
<span class="sd">        This synchronizes their cycle time .tyme to the Doist&#39;s tyme.</span>


<span class="sd">    .do method repeatedly runs .once until generators are complete</span>
<span class="sd">       it may either repeat as fast as possbile or repeat at real time increments.</span>

<span class="sd">    Inherited Class Attributes:</span>
<span class="sd">        .Tock is default .tock</span>

<span class="sd">    Attributes:</span>
<span class="sd">        real (boolean): True means run in real time, Otherwise as fast as possible.</span>
<span class="sd">        limit (float):  maximum run tyme limit then closes all doers</span>
<span class="sd">        done (boolean): True means completed due to limit or all deeds completed</span>
<span class="sd">                False is forced complete due to error</span>
<span class="sd">        doers (list): is list of doers</span>
<span class="sd">        timer (MonoTimer): for real time intervals</span>
<span class="sd">        always (boolean): True means keep running even when all dogs in deeds</span>
<span class="sd">                are complete. Enables dynamically managing extending or removing</span>
<span class="sd">                doers and associated deeds while running.</span>

<span class="sd">    Inherited Properties:</span>
<span class="sd">        tyme: is float relative cycle time, .tyme is artificial time</span>
<span class="sd">        : is float tyme increment of .tick()</span>

<span class="sd">    Properties:</span>

<span class="sd">    Inherited Methods:</span>
<span class="sd">        .tick increments .tyme by one .tock or provided tock</span>

<span class="sd">    Methods:</span>
<span class="sd">        .ready prepare deeds, deque of triples (dog, retyme, index)</span>
<span class="sd">        .once  run through all deeds once</span>
<span class="sd">        .do repeadedly call .once until all dogs in deeds are complete or</span>
<span class="sd">            times out do to reaching time limit</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Doist.__init__"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.Doist.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">doers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deeds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">always</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwa</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            instance</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tyme (float): initial value of cycle time in seconds (inherited)</span>
<span class="sd">            tock (float): tock time in seconds  (inherited)</span>
<span class="sd">            real (boolean): True means run in real time,</span>
<span class="sd">                            Otherwise run faster than real</span>
<span class="sd">            limit (float): seconds for max run time of doist. None means no limit.</span>
<span class="sd">            doers (list): Doer class instances, generator methods or</span>
<span class="sd">                function callables with attributes tock, done, and opts dict()</span>
<span class="sd">                used to initialize .doers.</span>
<span class="sd">                The .doers attribute is used throughout the execution lifecycle.</span>
<span class="sd">                Parameterization elsewhere of doers enables some special cases.</span>
<span class="sd">                The normal case is to initialize here or in .do().</span>
<span class="sd">            deeds (deque): deed tuples triples of form (dog, retyme, index)</span>
<span class="sd">                that initializes .deeds. If not provided .deeds is new empty deque.</span>
<span class="sd">                The .deeds attribute is used to update the throughout the</span>
<span class="sd">                execution lifecycle. The Parameterization elsewhere of deeds enables</span>
<span class="sd">                some special cases. The normal case is use the default empty</span>
<span class="sd">                initialization performed here and update in .ready().</span>
<span class="sd">            always (Boolean): True means keep running even when all dogs in deeds</span>
<span class="sd">                are complete. Enables dynamically managing extending or removing</span>
<span class="sd">                doers and associated deeds while running.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Doist</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwa</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">real</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">real</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limit</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">limit</span><span class="p">))</span> <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doers</span> <span class="o">=</span> <span class="n">doers</span> <span class="k">if</span> <span class="n">doers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>  <span class="c1"># list of Doers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">timing</span><span class="o">.</span><span class="n">MonoTimer</span><span class="p">(</span><span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deeds</span> <span class="o">=</span> <span class="n">deeds</span> <span class="k">if</span> <span class="n">deeds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">deque</span><span class="p">()</span>  <span class="c1"># deque of deeds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">always</span> <span class="o">=</span> <span class="n">always</span></div>


<div class="viewcode-block" id="Doist.do"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.Doist.do">[docs]</a>    <span class="k">def</span> <span class="nf">do</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deeds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tyme</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Readies deeds deque from .doers or doers if any and then iteratively</span>
<span class="sd">        runs .once over deeds deque until completion of all deeds.</span>
<span class="sd">        Each entry in deeds is a triple (dog, retyme, index)  where:</span>
<span class="sd">            dog is generator</span>
<span class="sd">            retyme is tyme (real or simulated) in seconds when dog should run next</span>
<span class="sd">            index is position of associated doer in .doers list used to assign</span>
<span class="sd">                .done state to associated doer for dog</span>

<span class="sd">        If interrupted by exception call .close on each dog to force exit context.</span>

<span class="sd">        Keyboard interrupt (cntl-c) forces exit.</span>

<span class="sd">        Once finally clause closes a generator it must be reinited</span>
<span class="sd">        before it can be run again</span>

<span class="sd">        Parameters:</span>
<span class="sd">            doers (list): generator method or function callables with attributes</span>
<span class="sd">                tock, done, and opts dict(). This may be used to update the .doers</span>
<span class="sd">                attribute which is used throughout the execution lifecycle.</span>
<span class="sd">                If not provided uses .doers.</span>
<span class="sd">                Parameterization here of doers enables some special cases.</span>
<span class="sd">                The normal case is to initialize in .__init__ or here.</span>
<span class="sd">            deeds (deque): deed triples of form (dog, retyme, index).</span>
<span class="sd">                This may be used to update the .deeds attribute which is used</span>
<span class="sd">                throughout the execution lifecycle. If not provided uses .deeds.</span>
<span class="sd">                Parameterization here of deeds enables some special cases.</span>
<span class="sd">                The normal case default empty in .__init__ and update in .ready().</span>
<span class="sd">            limit (float): is real time limit on execution. Forces close of all dogs.</span>
<span class="sd">            tyme  (float): is optional starting tyme. Resets .tyme to tyme whe provided.</span>
<span class="sd">               If not provided uses current .tyme</span>
<span class="sd">            always (Boolean): True means keep running even when all dogs in deeds</span>
<span class="sd">                are complete. Enables dynamically managing extending or removing</span>
<span class="sd">                doers and associated deeds while running.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        See: https://stackoverflow.com/questions/40528867/setting-attributes-on-func</span>
<span class="sd">        For setting attributes on bound methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">always</span> <span class="o">=</span> <span class="n">always</span> <span class="k">if</span> <span class="n">always</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">always</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">doers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doers</span> <span class="o">=</span> <span class="n">doers</span>
        <span class="k">if</span> <span class="n">deeds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deeds</span> <span class="o">=</span> <span class="n">deeds</span>

        <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># time limt for running if any. useful in test</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">limit</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">limit</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">tyme</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># re-initialize starting tyme</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tyme</span> <span class="o">=</span> <span class="n">tyme</span>

        <span class="n">deeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ready</span><span class="p">(</span><span class="n">doers</span><span class="o">=</span><span class="n">doers</span><span class="p">)</span>  <span class="c1"># runs enter context on each doer</span>

        <span class="n">tymer</span> <span class="o">=</span> <span class="n">tyming</span><span class="o">.</span><span class="n">Tymer</span><span class="p">(</span><span class="n">tymth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tymen</span><span class="p">(),</span> <span class="n">duration</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">limit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>  <span class="c1"># always clean up resources upon exception</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># until doers complete or exception or keyboardInterrupt</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">once</span><span class="p">(</span><span class="n">deeds</span><span class="o">=</span><span class="n">deeds</span><span class="p">)</span>  <span class="c1"># increments .tyme runs recur context</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">real</span><span class="p">:</span>  <span class="c1"># wait for real time to expire</span>
                        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">expired</span><span class="p">:</span>
                            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">remaining</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">restart</span><span class="p">()</span>  <span class="c1">#  no time lost</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">deeds</span>  <span class="c1"># resets if extend or remove</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit</span> <span class="ow">and</span> <span class="n">tymer</span><span class="o">.</span><span class="n">expired</span><span class="p">:</span>  <span class="c1"># reached time limit</span>
                        <span class="k">break</span>  <span class="c1"># break out of forever loop</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">deeds</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">always</span><span class="p">:</span>  <span class="c1"># no deeds and not always</span>
                        <span class="k">break</span>  <span class="c1"># break out of forever loop</span>

                <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>  <span class="c1"># use CNTL-C to shutdown from shell</span>
                    <span class="k">break</span>

                <span class="k">except</span> <span class="ne">SystemExit</span><span class="p">:</span> <span class="c1"># Forced shutdown of process</span>
                    <span class="k">raise</span>

                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># Unknown exception</span>
                    <span class="k">raise</span>


        <span class="k">finally</span><span class="p">:</span> <span class="c1"># finally clause always runs regardless of exception or not.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">deeds</span><span class="o">=</span><span class="n">deeds</span><span class="p">)</span>  <span class="c1"># force close remaining deeds throws GeneratorExit</span></div>


<div class="viewcode-block" id="Doist.ready"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.Doist.ready">[docs]</a>    <span class="k">def</span> <span class="nf">ready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deeds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns deeds deque of triples (dog, retyme, index)  where:</span>
<span class="sd">            dog is generator</span>
<span class="sd">            retyme is tyme (real or simulated) in seconds when dog should run next</span>
<span class="sd">            index is position of associated doer in .doers list used to assign</span>
<span class="sd">                .done state to associated doer for dog</span>

<span class="sd">        Calls each generator callable (instance or function or method) in .doers</span>
<span class="sd">        to create each generator dog. Injects own tymth function closure, and</span>
<span class="sd">            generator function&#39;s own tock, and opts.</span>

<span class="sd">        Runs enter context of each dog by calling next(dog)</span>

<span class="sd">        Parameters:</span>
<span class="sd">            doers is list of generator method or function callables with attributes</span>
<span class="sd">                .tock is tyme increment in seconds</span>
<span class="sd">                .done is Boolean completion state</span>
<span class="sd">                .opts is dict() of optional parameters</span>
<span class="sd">                If not provided uses .doers.</span>
<span class="sd">                The normal case is to initialize in .__init__. or .do().</span>
<span class="sd">            deeds is deque of deed triples of form (dog, retyme, index).</span>
<span class="sd">                If not provided uses .deeds. This may be used to update the</span>
<span class="sd">                .deeds attribute which is used throughout the execution lifecycle.</span>
<span class="sd">                Parameterization here of deeds enables some special cases.</span>
<span class="sd">                The normal case is the default empty initialization in .__init__</span>
<span class="sd">                and then update here.</span>

<span class="sd">        See: https://stackoverflow.com/questions/40528867/setting-attributes-on-func</span>
<span class="sd">        For setting attributes on bound methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">doers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">doers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doers</span>
        <span class="k">if</span> <span class="n">deeds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">deeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deeds</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">doer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">doers</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">doer</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1">#  None before enter. enter may set to False</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># when using bound method for generator function</span>
                <span class="n">doer</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># None before enter. enter may set to False</span>

            <span class="n">opts</span> <span class="o">=</span> <span class="n">doer</span><span class="o">.</span><span class="n">opts</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">doer</span><span class="p">,</span> <span class="s2">&quot;opts&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="p">{}</span>
            <span class="n">dog</span> <span class="o">=</span> <span class="n">doer</span><span class="p">(</span><span class="n">tymth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tymen</span><span class="p">(),</span> <span class="n">tock</span><span class="o">=</span><span class="n">doer</span><span class="o">.</span><span class="n">tock</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">next</span><span class="p">(</span><span class="n">dog</span><span class="p">)</span>  <span class="c1"># run enter by advancing to first yield</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># don&#39;t append</span>
            <span class="n">deeds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tyme</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">deeds</span></div>


<div class="viewcode-block" id="Doist.once"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.Doist.once">[docs]</a>    <span class="k">def</span> <span class="nf">once</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deeds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cycle once through deeds deque of triples and update in place</span>
<span class="sd">        deeds is deque of triples of (dog, retyme, index) where:</span>
<span class="sd">            dog is generator</span>
<span class="sd">            retyme is tyme (real or simulated) in seconds when dog should run next</span>
<span class="sd">            index is position of associated doer in .doers list used to assign</span>
<span class="sd">                .done state to associated doer for dog</span>

<span class="sd">        Each cycle checks all generators in deeds deque and runs if retyme past.</span>
<span class="sd">        At end of cycle advances .tyme by one .tock by calling .tick()</span>

<span class="sd">        Parameters:</span>
<span class="sd">            doers is list of generator method or function callables with attributes</span>
<span class="sd">                tock, done, and opts dict(). If not provided uses .doers.</span>
<span class="sd">                Parameterization here of doers enables some special cases.</span>
<span class="sd">                The normal case is to initialize in .__init__. or .do()</span>
<span class="sd">            deeds is deque of deed triples of form (dog, retyme, index).</span>
<span class="sd">                If not provided uses .deeds.</span>
<span class="sd">                Parameterization here of deeds enables some special cases.</span>
<span class="sd">                The normal case is use empty initialize in .__init__. and</span>
<span class="sd">                then update in .ready()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">doers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">doers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doers</span>
        <span class="k">if</span> <span class="n">deeds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">deeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deeds</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">deeds</span><span class="p">)):</span>  <span class="c1"># iterate once over each deed</span>
            <span class="n">dog</span><span class="p">,</span> <span class="n">retyme</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">deeds</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>  <span class="c1"># pop it off</span>

            <span class="k">if</span> <span class="n">retyme</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tyme</span><span class="p">:</span>  <span class="c1"># run it now</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tock</span> <span class="o">=</span> <span class="n">dog</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tyme</span><span class="p">)</span>  <span class="c1"># send tyme. yield tock</span>
                <span class="k">except</span> <span class="ne">StopIteration</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>  <span class="c1"># returned instead of yielded</span>
                    <span class="n">doer</span> <span class="o">=</span> <span class="n">doers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">doer</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="n">ex</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="kc">False</span>  <span class="c1"># assign done state</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>   <span class="c1"># when using bound method for generator function</span>
                        <span class="n">doer</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="n">ex</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="kc">False</span>  <span class="c1"># assign done state</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># reappend for next pass</span>
                    <span class="k">if</span> <span class="n">tock</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># bare yield returns None</span>
                        <span class="n">tock</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># rerun asap when tock == 0.0</span>
                    <span class="n">deeds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dog</span><span class="p">,</span> <span class="n">retyme</span> <span class="o">+</span> <span class="n">tock</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>  <span class="c1"># tock may change during run</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># not retyme yet</span>
                <span class="n">deeds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dog</span><span class="p">,</span> <span class="n">retyme</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>  <span class="c1"># reappend for next pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span>  <span class="c1"># advance .tyme by one doist .tock</span></div>


<div class="viewcode-block" id="Doist.close"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.Doist.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deeds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Force exit each still opened deed calling .close on the dog generator</span>
<span class="sd">        which throws a GeneratorExit to the generator.</span>
<span class="sd">        This executes the close context (GeneratorExit) which then excecutes</span>
<span class="sd">        the exit context in the finally caluse. Each dogs exit is responsible</span>
<span class="sd">        for releasing resources</span>
<span class="sd">        Previously aborted or closed dogs have already exited</span>
<span class="sd">        Close any running dogs in reverse order so that enters and exits are</span>
<span class="sd">        nested pairs so that the corresponding exits appear in reverse order</span>
<span class="sd">        to their entes. This preserves nested resource dependencies.</span>
<span class="sd">        For example:</span>
<span class="sd">            enter A,</span>
<span class="sd">                enter B,</span>
<span class="sd">                    enter C,</span>
<span class="sd">                    exit C,</span>
<span class="sd">                exit B,</span>
<span class="sd">            exit A</span>

<span class="sd">        parameters:</span>
<span class="sd">            doers is list of generator method or function callables with attributes</span>
<span class="sd">                tock, done, and opts dict(). If not provided uses .doers.</span>
<span class="sd">                Parameterization here of doers enables some special cases.</span>
<span class="sd">                The normal case is to initialize in .__init__. or .do()</span>
<span class="sd">            deeds is deque of deed triples of form (dog, retyme, index).</span>
<span class="sd">                If not provided uses .deeds.</span>
<span class="sd">                Parameterization here of deeds enables some special cases.</span>
<span class="sd">                The normal case is use empty initialize in .__init__. and</span>
<span class="sd">                then update in .ready()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">doers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">doers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doers</span>
        <span class="k">if</span> <span class="n">deeds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">deeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deeds</span>

        <span class="k">while</span><span class="p">(</span><span class="n">deeds</span><span class="p">):</span>  <span class="c1"># .close each remaining dog in deeds in reverse order</span>
            <span class="n">dog</span><span class="p">,</span> <span class="n">retime</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">deeds</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="c1">#pop it off</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tock</span> <span class="o">=</span> <span class="n">dog</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># force GeneratorExit. Maybe log exit tock tyme</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># Hmm? Not supposed to happen!</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># set done state</span>
                <span class="n">doer</span> <span class="o">=</span> <span class="n">doers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">doer</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># forced close</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># when using bound method for generator function</span>
                    <span class="n">doer</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># forced close</span></div>


<div class="viewcode-block" id="Doist.extend"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.Doist.extend">[docs]</a>    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doers</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extend .doers list with doers. Ready deeds from doers and extend .doers</span>
<span class="sd">        and .deeds.  Edit deeds in place so not replace deque.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            doers is list of doers to add as extension.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">deeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ready</span><span class="p">(</span><span class="n">doers</span><span class="o">=</span><span class="n">doers</span><span class="p">,</span> <span class="n">deeds</span><span class="o">=</span><span class="n">deque</span><span class="p">())</span>  <span class="c1"># provide fresh deeds</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doers</span><span class="p">)</span>  <span class="c1"># get offset of index for extending dogs</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">deeds</span><span class="p">)):</span>  <span class="c1"># iterate once over each deed</span>
            <span class="n">dog</span><span class="p">,</span> <span class="n">retyme</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">deeds</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="n">offset</span>
            <span class="n">deeds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dog</span><span class="p">,</span> <span class="n">retyme</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">doers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deeds</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">deeds</span><span class="p">)</span></div>


<div class="viewcode-block" id="Doist.remove"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.Doist.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doers</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove doers from .doers list and any associated deeds from .deeds deque.</span>
<span class="sd">        Force close removed deeds.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            doers is list of doers to remove.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rdoers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">doers</span><span class="p">)</span>  <span class="c1"># doers to remove, make copy since destructive</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># map indices for each doer as appears in .doers to rdoers</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># index in remove list</span>
        <span class="k">for</span> <span class="n">doer</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rdoers</span><span class="p">):</span>  <span class="c1"># make copy since inplace filter of rdoers</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">doer</span><span class="p">)</span>  <span class="c1"># make sure a member of .doers</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">rdoers</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">doer</span><span class="p">)</span>  <span class="c1"># not in .doers so ignore remove from rdoers</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">rdeeds</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>  <span class="c1"># fresh deque for deeds to remove</span>
        <span class="n">deeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deeds</span>  <span class="c1"># edit update self.deeds in place</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># reappended index of remaining (not removed) deed</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">deeds</span><span class="p">)):</span>  <span class="c1"># iterate once over each deed</span>
            <span class="n">dog</span><span class="p">,</span> <span class="n">retyme</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">deeds</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>  <span class="c1"># found deed to remove and close</span>
                <span class="n">rdeeds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dog</span><span class="p">,</span> <span class="n">retyme</span><span class="p">,</span> <span class="n">indices</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>  <span class="c1"># add to removal deque</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># keep deed do not remove and close</span>
                <span class="n">deeds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dog</span><span class="p">,</span> <span class="n">retyme</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>  <span class="c1"># reappend</span>
                <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">doer</span> <span class="ow">in</span> <span class="n">rdoers</span><span class="p">:</span>  <span class="c1"># update .doers to remove rdoers</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doers</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">doer</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">doers</span><span class="o">=</span><span class="n">rdoers</span><span class="p">,</span> <span class="n">deeds</span><span class="o">=</span><span class="n">rdeeds</span><span class="p">)</span></div></div>



<div class="viewcode-block" id="doify"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.doify">[docs]</a><span class="k">def</span> <span class="nf">doify</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tock</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns Doist compatible copy, g, of converted generator function f.</span>
<span class="sd">    Each invoction of doify(f) returns a unique copy of doified function f.</span>
<span class="sd">    Imbues copy, g, of converted generator function, f, with attributes used by</span>
<span class="sd">    Doist.ready() or DoDoer.enter().</span>
<span class="sd">    Allows multiple instances of copy, g, of generator function, f, each with</span>
<span class="sd">    unique attributes.</span>

<span class="sd">    Usage:</span>
<span class="sd">    def f():</span>
<span class="sd">       pass</span>

<span class="sd">    c = doify(f, name=&#39;c&#39;)</span>

<span class="sd">    Parameters:</span>
<span class="sd">        f is generator function</span>
<span class="sd">        name is new function name for returned doified copy g. Default is to copy</span>
<span class="sd">            f.__name__</span>
<span class="sd">        tock is default tock attribute of doified copy g</span>
<span class="sd">        opts is dictionary of remaining parameters that becomes .opts attribute</span>
<span class="sd">            of doified copy g</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">helping</span><span class="o">.</span><span class="n">copy_func</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">tock</span> <span class="o">=</span> <span class="n">tock</span>  <span class="c1"># default tock attributes</span>
    <span class="n">g</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># default done state</span>
    <span class="n">g</span><span class="o">.</span><span class="n">opts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>  <span class="c1">#  default opts attribute</span>
    <span class="k">return</span> <span class="n">g</span></div>


<div class="viewcode-block" id="doize"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.doize">[docs]</a><span class="k">def</span> <span class="nf">doize</span><span class="p">(</span><span class="n">tock</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns decorator that makes decorated generator function Doist compatible.</span>
<span class="sd">    Imbues decorated generator function with attributes used by Doist.ready() or</span>
<span class="sd">    DoDoer.enter().</span>
<span class="sd">    Only one instance of decorated function with shared attributes is allowed.</span>

<span class="sd">    Usage:</span>
<span class="sd">    @doize</span>
<span class="sd">    def f():</span>
<span class="sd">       pass</span>

<span class="sd">    Parameters:</span>
<span class="sd">        tock is default tock attribute of doized f</span>
<span class="sd">        opts is dictionary of remaining parameters that becomes .opts attribute</span>
<span class="sd">            of doized f</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="c1"># must create copy not wrapper so inspect.isgeneratorfunction works</span>
        <span class="c1"># result of decoration</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">helping</span><span class="o">.</span><span class="n">copy_func</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">tock</span> <span class="o">=</span> <span class="n">tock</span>  <span class="c1"># default tock attributes</span>
        <span class="n">g</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># default done state</span>
        <span class="n">g</span><span class="o">.</span><span class="n">opts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>  <span class="c1"># default opts attribute</span>
        <span class="k">return</span> <span class="n">g</span>
    <span class="k">return</span> <span class="n">decorator</span></div>


<div class="viewcode-block" id="Doer"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.Doer">[docs]</a><span class="k">class</span> <span class="nc">Doer</span><span class="p">(</span><span class="n">tyming</span><span class="o">.</span><span class="n">Tymee</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Doer base class for hierarchical structured async coroutine like generators.</span>
<span class="sd">    Doer.__call__ on instance returns generator.</span>
<span class="sd">    Interface for Doist etc is generator function like object.</span>
<span class="sd">    Doer is generator method instance creator and has extra methods and</span>
<span class="sd">    attributes that a plain generator function does not</span>

<span class="sd">    The .do method executes other methods each corresponding to one of the</span>
<span class="sd">    six econtexts:</span>
<span class="sd">        enter, recur, clean, exit, (unforced) close, abort (forced)</span>

<span class="sd">    Actual context order may be one of:</span>
<span class="sd">        enter, recur, clean, exit</span>
<span class="sd">        enter, recur, close, exit</span>
<span class="sd">        enter, recur, abort, exit</span>
<span class="sd">        enter, abort, exit</span>

<span class="sd">    Attributes:</span>
<span class="sd">        .done is Boolean completion state:</span>
<span class="sd">            True means completed</span>
<span class="sd">            Otherwise incomplete. Incompletion maybe due to close or abort.</span>
<span class="sd">        .opts is dict of injected options into its .do generator by scheduler</span>

<span class="sd">    Inherited Properties:</span>
<span class="sd">        .tyme is float relative cycle time of associated Tymist .tyme obtained</span>
<span class="sd">            via injected .tymth function wrapper closure.</span>
<span class="sd">        .tymth is function wrapper closure returned by Tymist .tymeth() method.</span>
<span class="sd">            When .tymth is called it returns associated Tymist .tyme.</span>
<span class="sd">            .tymth provides injected dependency on Tymist tyme base.</span>

<span class="sd">    Properties:</span>
<span class="sd">        .tock is float, desired time in seconds between runs or until next run,</span>
<span class="sd">                 non negative, zero means run asap</span>

<span class="sd">    Inherited Methods:</span>
<span class="sd">        .wind  injects ._tymth dependency from associated Tymist to get its .tyme</span>

<span class="sd">    Methods:</span>
<span class="sd">        .__call__ makes instance callable</span>
<span class="sd">            Appears as generator function that returns generator</span>
<span class="sd">        .do is generator method that returns generator</span>
<span class="sd">        .enter is enter context action method</span>
<span class="sd">        .recur is recur context action method or generator method</span>
<span class="sd">        .clean is clean context action method</span>
<span class="sd">        .exit is exit context method</span>
<span class="sd">        .close is close context method</span>
<span class="sd">        .abort is abort context method</span>

<span class="sd">    Hidden:</span>
<span class="sd">        ._tymth is injected function wrapper closure returned by .tymen() of</span>
<span class="sd">            associated Tymist instance that returns Tymist .tyme. when called.</span>
<span class="sd">        ._tock is hidden attribute for .tock property</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Doer.__init__"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.Doer.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tock</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwa</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize instance.</span>

<span class="sd">        Inherited Parameters:</span>
<span class="sd">            tymth is injected function wrapper closure returned by .tymen() of</span>
<span class="sd">                Tymist instance. Calling tymth() returns associated Tymist .tyme.</span>

<span class="sd">        Parameters:</span>
<span class="sd">           tock is float seconds initial value of .tock</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Doer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tock</span> <span class="o">=</span> <span class="n">tock</span>  <span class="c1"># desired tyme interval between runs, 0.0 means asap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1">#  default completion state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opts</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># used for injection of options into .do by scheduler</span></div>


<div class="viewcode-block" id="Doer.__call__"><a class="viewcode-back" href="../../../autoapi/hio/base/doing/index.html#hio.base.doing.Doer.__call__">[docs]</a>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwa</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns generator</span>
<span class="sd">        Does not advance to first yield.</span>
<span class="sd">        The advance to first yield effectively invodes the enter or open context</span>
<span class="sd">        on the generator.</span>
<span class="sd">        To enter either call .next or .send(None) on generator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">(</span><span class="o">**</span><span class="n">kwa</span><span class="p">)</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="Doer.tock"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.Doer.tock">[docs]</a>    <span class="k">def</span> <span class="nf">tock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        tock property getter, get ._tock</span>
<span class="sd">        .tock is float desired .tyme increment in seconds</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tock</span></div>


    <span class="nd">@tock</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tock</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        desired cycle tyme interval until next run</span>
<span class="sd">        0.0 means run asap,</span>
<span class="sd">        set ._tock to tock</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tock</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tock</span><span class="p">))</span>


<div class="viewcode-block" id="Doer.do"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.Doer.do">[docs]</a>    <span class="k">def</span> <span class="nf">do</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tymth</span><span class="p">,</span> <span class="n">tock</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generator method to run this doer.</span>
<span class="sd">        Calling this method returns generator.</span>
<span class="sd">        Interface matches generator function for compatibility.</span>
<span class="sd">        To customize create subclasses and override the lifecycle methods:</span>
<span class="sd">            .enter, .recur, .exit, .close, .abort</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tymth is injected function wrapper closure returned by .tymen() of</span>
<span class="sd">                Tymist instance. Calling tymth() returns associated Tymist .tyme.</span>
<span class="sd">            tock is injected initial tock value</span>
<span class="sd">            args is dict of injected optional additional parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># enter context</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wind</span><span class="p">(</span><span class="n">tymth</span><span class="p">)</span>  <span class="c1"># update tymist dependencies</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tock</span> <span class="o">=</span> <span class="n">tock</span>  <span class="c1">#  set tock to parameter</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># allows enter to override completion state</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enter</span><span class="p">()</span>

            <span class="c1">#recur context</span>
            <span class="k">if</span> <span class="n">isgeneratorfunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recur</span><span class="p">):</span>  <span class="c1">#  .recur is generator method</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">recur</span><span class="p">()</span>  <span class="c1"># recur context delegated</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># .recur is standard method so iterate in while loop</span>
                <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">done</span><span class="p">):</span>  <span class="c1"># recur context</span>
                    <span class="n">tyme</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tock</span><span class="p">))</span>  <span class="c1"># yields .tock then waits for next send</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recur</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="n">tyme</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">GeneratorExit</span><span class="p">:</span>  <span class="c1"># close context, forced exit due to .close</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>  <span class="c1"># abort context, forced exit due to uncaught exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">(</span><span class="n">ex</span><span class="o">=</span><span class="n">ex</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># clean context</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>

        <span class="k">finally</span><span class="p">:</span>  <span class="c1"># exit context, exit, unforced if normal exit of try, forced otherwise</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

        <span class="c1"># return value of yield from or StopIteration.value indicates completion</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">done</span>  <span class="c1"># Only returns done state if normal return not close or abort raise</span></div>


<div class="viewcode-block" id="Doer.enter"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.Doer.enter">[docs]</a>    <span class="k">def</span> <span class="nf">enter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></div>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do &#39;enter&#39; context actions. Override in subclass. Not a generator method.</span>
<span class="sd">        Set up resources. Comparable to context manager enter.</span>
<span class="sd">        &quot;&quot;&quot;</span>


<div class="viewcode-block" id="Doer.recur"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.Doer.recur">[docs]</a>    <span class="k">def</span> <span class="nf">recur</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tyme</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do &#39;recur&#39; context actions. Override in subclass.</span>
<span class="sd">        Regular method that perform repetitive actions once per invocation.</span>
<span class="sd">        Assumes resource setup in .enter() and resource takedown in .exit()</span>
<span class="sd">        (see ReDoer below for example of .recur that is a generator method)</span>

<span class="sd">        Returns completion state of recurrence actions.</span>
<span class="sd">           True means done False means continue</span>

<span class="sd">        Parameters:</span>
<span class="sd">            Doist feeds its .tyme through .send to .do yield which passes it here.</span>


<span class="sd">        .recur maybe implemented by a subclass either as a non-generator method</span>
<span class="sd">        or a generator method. This stub here is as a non-generator method.</span>
<span class="sd">        The base class .do detects which type:</span>
<span class="sd">            If non-generator .do method runs .recur method once per iteration</span>
<span class="sd">                until .recur returns (True)</span>
<span class="sd">            If generator .do method runs .recur with (yield from) until .recur</span>
<span class="sd">                returns (see ReDoer for example of generator .recur)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="Doer.clean"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.Doer.clean">[docs]</a>    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></div>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do &#39;clean&#39; context actions. Override in subclass. Not a generator method.</span>
<span class="sd">        Clean up resources that are unique to a clean exit.</span>
<span class="sd">        Called by else after normal return.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Doer.exit"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.Doer.exit">[docs]</a>    <span class="k">def</span> <span class="nf">exit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></div>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do &#39;exit&#39; context actions. Override in subclass. Not a generator method.</span>
<span class="sd">        Clean up resources. Comparable to context manager exit.</span>
<span class="sd">        Called by finally after normal return, close, or abort.</span>
<span class="sd">        After .exit() do returns resulting in StopIteration.</span>
<span class="sd">        &quot;&quot;&quot;</span>


<div class="viewcode-block" id="Doer.close"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.Doer.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></div>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do &#39;close&#39; context actions. Override in subclass. Not a generator method.</span>
<span class="sd">        Forced close by thrown generator .close() method causing GeneratorExit.</span>
<span class="sd">        .exit() is finally called after .close().</span>
<span class="sd">        &quot;&quot;&quot;</span>


<div class="viewcode-block" id="Doer.abort"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.Doer.abort">[docs]</a>    <span class="k">def</span> <span class="nf">abort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ex</span><span class="p">):</span></div></div>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do &#39;abort&#39; context actions. Override in subclass. Not a generator method.</span>
<span class="sd">        Parameters:</span>
<span class="sd">            ex is Exception instance that caused abort.</span>
<span class="sd">        Unexpected exception that results in generator exiting but not GeneratorExit.</span>
<span class="sd">        .exit() is finally called after .abort().</span>
<span class="sd">        &quot;&quot;&quot;</span>


<div class="viewcode-block" id="ReDoer"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.ReDoer">[docs]</a><span class="k">class</span> <span class="nc">ReDoer</span><span class="p">(</span><span class="n">Doer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ReDoer is an example sub class whose .recur is a generator method not a</span>
<span class="sd">    plain method. Its .do method detects that its .recur is a generator method</span>
<span class="sd">    and executes it using yield from instead of just calling the method.</span>

<span class="sd">    Inherited Attributes:</span>
<span class="sd">        .done is Boolean completion state:</span>
<span class="sd">            True means completed</span>
<span class="sd">            Otherwise incomplete. Incompletion maybe due to close or abort.</span>
<span class="sd">        .opts is dict of injected options into its .do generator by scheduler</span>

<span class="sd">    Inherited Properties:</span>
<span class="sd">         .tyme is float relative cycle time of associated Tymist .tyme obtained</span>
<span class="sd">            via injected .tymth function wrapper closure.</span>
<span class="sd">        .tymth is function wrapper closure returned by Tymist .tymeth() method.</span>
<span class="sd">            When .tymth is called it returns associated Tymist .tyme.</span>
<span class="sd">            .tymth provides injected dependency on Tymist tyme base.</span>
<span class="sd">        .tock is float, desired time in seconds between runs or until next run,</span>
<span class="sd">                 non negative, zero means run asap</span>

<span class="sd">    Inherited Methods:</span>
<span class="sd">        .wind  injects ._tymth dependency from associated Tymist to get its .tyme</span>
<span class="sd">        .__call__ makes instance callable</span>
<span class="sd">            Appears as generator function that returns generator</span>
<span class="sd">        .do is generator method that returns generator</span>
<span class="sd">        .enter is enter context action method</span>
<span class="sd">        .recur is recur context action method or generator method</span>
<span class="sd">        .exit is exit context method</span>
<span class="sd">        .close is close context method</span>
<span class="sd">        .abort is abort context method</span>

<span class="sd">    Overidden Methods:</span>
<span class="sd">        .recur</span>

<span class="sd">    Hidden:</span>
<span class="sd">       ._tymth is injected function wrapper closure returned by .tymen() of</span>
<span class="sd">            associated Tymist instance that returns Tymist .tyme. when called.</span>
<span class="sd">       ._tock is hidden attribute for .tock property</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ReDoer.recur"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.ReDoer.recur">[docs]</a>    <span class="k">def</span> <span class="nf">recur</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do &#39;recur&#39; context actions as a generator method. Override in subclass.</span>
<span class="sd">        Assumes resource setup in .enter() and resource takedown in .exit()</span>
<span class="sd">        (see Doer for example of .recur that is a regular method)</span>

<span class="sd">        yield the current .tock</span>
<span class="sd">        accepts the current tyme</span>
<span class="sd">        returns the .done</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tyme is initial output of send fed to do yield, Doist feeds its .tyme</span>
<span class="sd">        Returns completion state of recurrence actions.</span>
<span class="sd">           True means done False means continue</span>
<span class="sd">        Maybe a non-generator method or a generator method.</span>
<span class="sd">        For base class do:</span>
<span class="sd">            non-generator recur method runs until returns (True)</span>
<span class="sd">            generator recur method runs until returns (yield from)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># print(&quot;ReDoer recur before yield. tyme = {} count={}\n&quot;.format(tyme, count))</span>
        <span class="k">while</span> <span class="p">(</span><span class="kc">True</span><span class="p">):</span>  <span class="c1"># recur context</span>
            <span class="n">tyme</span> <span class="o">=</span> <span class="k">yield</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tock</span><span class="p">)</span>  <span class="c1"># first yield of None</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># print(&quot;ReDoer recur after yield. tyme = {} count={}\n&quot;.format(tyme, count))</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c1"># print(&quot;ReDoer recur after break tyme = {} count={}\n&quot;.format(tyme, count))</span>
        <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># done</span></div></div>



<div class="viewcode-block" id="DoDoer"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.DoDoer">[docs]</a><span class="k">class</span> <span class="nc">DoDoer</span><span class="p">(</span><span class="n">Doer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    DoDoer implements Doist like functionality to allow nested scheduling of Doers.</span>
<span class="sd">    Each DoDoer runs a list of doers like a Doist but using the tyme from its</span>
<span class="sd">       injected tymth for the associated tymist as injected by its ultimate root</span>
<span class="sd">       parent Doist and any intervening parent DoDoer(s).</span>

<span class="sd">    Scheduling hierarchy: Doist-&gt;DoDoer...-&gt;DoDoer-&gt;Doers</span>

<span class="sd">    Inherited Attributes:</span>
<span class="sd">        .done is Boolean completion state:</span>
<span class="sd">            True means completed</span>
<span class="sd">            Otherwise incomplete. Incompletion maybe due to close or abort.</span>
<span class="sd">        .opts is dict of injected options for its generator .do</span>

<span class="sd">    Attributes:</span>

<span class="sd">    Inherited Properties:</span>
<span class="sd">        .tyme is float relative cycle time of associated Tymist .tyme obtained</span>
<span class="sd">            via injected .tymth function wrapper closure.</span>
<span class="sd">        .tymth is function wrapper closure returned by Tymist .tymeth() method.</span>
<span class="sd">            When .tymth is called it returns associated Tymist .tyme.</span>
<span class="sd">            .tymth provides injected dependency on Tymist tyme base.</span>
<span class="sd">        .tock is float, desired time in seconds between runs or until next run,</span>
<span class="sd">                 non negative, zero means run asap</span>

<span class="sd">    Properties:</span>
<span class="sd">        .doers is list of Doers or Doist compatible generator instances,</span>
<span class="sd">            functions, or methods.</span>
<span class="sd">        .deeds is deque of triples (dog, retyme, index)  where:</span>
<span class="sd">            dog is generator</span>
<span class="sd">            retyme is tyme in seconds when next should run may be real or simulated</span>
<span class="sd">            index is position of associated doer in .doers list</span>
<span class="sd">        .always is Boolean, True means keep running even when all dogs in deeds</span>
<span class="sd">            are complete. Enables dynamically managing extending or removing</span>
<span class="sd">            doers and associated deeds while running.</span>

<span class="sd">    Inherited Methods:</span>
<span class="sd">        .wind  injects ._tymth dependency from associated Tymist to get its .tyme</span>
<span class="sd">        .__call__ makes instance callable</span>
<span class="sd">            Appears as generator function that returns generator</span>
<span class="sd">        .do is generator method that returns generator</span>
<span class="sd">        .enter is enter context action method</span>
<span class="sd">        .recur is recur context action method or generator method</span>
<span class="sd">        .clean is clean context action method</span>
<span class="sd">        .exit is exit context method</span>
<span class="sd">        .close is close context method</span>
<span class="sd">        .abort is abort context method</span>

<span class="sd">    Overidden Methods:</span>
<span class="sd">        .do</span>
<span class="sd">        .enter</span>
<span class="sd">        .recur</span>
<span class="sd">        .exit</span>

<span class="sd">    Hidden:</span>
<span class="sd">       ._tymth is injected function wrapper closure returned by .tymen() of</span>
<span class="sd">            associated Tymist instance that returns Tymist .tyme. when called.</span>
<span class="sd">       ._tock is hidden attribute for .tock property</span>
<span class="sd">       ._always is hidden attribute for .always property</span>
<span class="sd">       ._doers is hidden attribute for .doers property</span>
<span class="sd">       ._deeds is hidden attribute for .deeds property</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DoDoer.__init__"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.DoDoer.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deeds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwa</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize instance.</span>

<span class="sd">        Inherited Parameters:</span>
<span class="sd">            tymth is injected function wrapper closure returned by .tymen() of</span>
<span class="sd">                Tymist instance. Calling tymth() returns associated Tymist .tyme.</span>
<span class="sd">            tock is float seconds initial value of .tock</span>

<span class="sd">        Parameters:</span>
<span class="sd">            doers is list of Doer class instances, generator methods or function</span>
<span class="sd">                callables with attributes tock, done, and opts dict() used to</span>
<span class="sd">                initialize .doers.</span>
<span class="sd">                The .doers attribute is used throughout the execution lifecycle.</span>
<span class="sd">                Parameterization elsewhere of doers enables some special cases.</span>
<span class="sd">                The normal case is to initialize here.</span>
<span class="sd">            deeds is deque of deed triples of form (dog, retyme, index) that</span>
<span class="sd">                initializes .deeds. If not provided creates empty .deeds.</span>
<span class="sd">                The .deeds attribute is used to update the throughout the</span>
<span class="sd">                execution lifecycle. The Parameterization elsewhere of deeds enables</span>
<span class="sd">                some special cases. The normal case is use the default empty</span>
<span class="sd">                initialization performed here.</span>
<span class="sd">            always is Boolean, True means keep running even when all dogs in deeds</span>
<span class="sd">                are complete. Enables dynamically managing extending or removing</span>
<span class="sd">                doers and associated deeds while running.</span>

<span class="sd">        In each deed the index must match offset of the doer in the doers list.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DoDoer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doers</span> <span class="o">=</span> <span class="n">doers</span> <span class="k">if</span> <span class="n">doers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deeds</span> <span class="o">=</span> <span class="n">deeds</span> <span class="k">if</span> <span class="n">deeds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">deque</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">always</span> <span class="o">=</span> <span class="n">always</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="DoDoer.doers"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.DoDoer.doers">[docs]</a>    <span class="k">def</span> <span class="nf">doers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        doers property getter, get ._doers</span>
<span class="sd">        .doers is list of doist compatible generator instances, functions, or</span>
<span class="sd">            methods</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_doers</span></div>


    <span class="nd">@doers</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">doers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doers</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set ._doers to doers list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">doers</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Expected list, got </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">doers</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_doers</span> <span class="o">=</span> <span class="n">doers</span>


    <span class="nd">@property</span>
<div class="viewcode-block" id="DoDoer.deeds"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.DoDoer.deeds">[docs]</a>    <span class="k">def</span> <span class="nf">deeds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        deeds property getter, get ._deeds</span>
<span class="sd">        .deeds is deque of triples, each of form (dog, retyme, index)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deeds</span></div>


    <span class="nd">@deeds</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">deeds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deeds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set ._deeds to deeds deque</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">deeds</span><span class="p">,</span> <span class="n">deque</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Expected deque, got </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">deeds</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deeds</span> <span class="o">=</span> <span class="n">deeds</span>


    <span class="nd">@property</span>
<div class="viewcode-block" id="DoDoer.always"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.DoDoer.always">[docs]</a>    <span class="k">def</span> <span class="nf">always</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        always property getter, get ._always</span>
<span class="sd">        .always is Boolean, True means keep running even when all dogs in deeds</span>
<span class="sd">            are complete. Enables dynamically managing extending or removing</span>
<span class="sd">            doers and associated deeds while running.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_always</span></div>


    <span class="nd">@always</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">always</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">always</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set ._always to always</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_always</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">always</span> <span class="k">else</span> <span class="kc">False</span>


<div class="viewcode-block" id="DoDoer.do"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.DoDoer.do">[docs]</a>    <span class="k">def</span> <span class="nf">do</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tymth</span><span class="p">,</span> <span class="n">tock</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">doers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deeds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generator method to run this doer. Equivalent of doist.do</span>
<span class="sd">        Calling this method returns generator</span>
<span class="sd">        Interface matched generator function for compatibility</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tymth is injected function wrapper closure returned by .tymen() of</span>
<span class="sd">                Tymist instance. Calling tymth() returns associated Tymist .tyme.</span>
<span class="sd">            tock is injected initial tock value</span>
<span class="sd">            doers is list of generator method or function callables with attributes</span>
<span class="sd">                tock, done, and opts dict(). This may be used to update the .doers</span>
<span class="sd">                attribute which is used throughout the execution lifecycle.</span>
<span class="sd">                If not provided uses .doers.</span>
<span class="sd">                Parameterization here of doers enables some special cases.</span>
<span class="sd">                The normal case is to initialize in .__init__.</span>
<span class="sd">            deeds is deque of deed triples of form (dog, retyme, index).</span>
<span class="sd">                This may be used to update the .deeds attribute which is used</span>
<span class="sd">                throughout the execution lifecycle. If not provided uses .deeds.</span>
<span class="sd">                Parameterization here of deeds enables some special cases.</span>
<span class="sd">                The normal case is to initialize in .__init__.</span>
<span class="sd">            always is Boolean. True means keep running even when all dogs in deeds</span>
<span class="sd">                are complete. Enables dynamically managing extending or removing</span>
<span class="sd">                doers and associated deeds while running.</span>
<span class="sd">                When not provided use .always.</span>
<span class="sd">            opts is dict of injected optional additional parameters</span>

<span class="sd">        In each deed the index must match offset of the doer in the doers list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">always</span> <span class="o">=</span> <span class="n">always</span> <span class="k">if</span> <span class="n">always</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">always</span>
        <span class="k">if</span> <span class="n">doers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doers</span> <span class="o">=</span> <span class="n">doers</span>
        <span class="k">if</span> <span class="n">deeds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deeds</span> <span class="o">=</span> <span class="n">deeds</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># enter context</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wind</span><span class="p">(</span><span class="n">tymth</span><span class="p">)</span>  <span class="c1"># change tymist dependencies</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tock</span> <span class="o">=</span> <span class="n">tock</span>  <span class="c1">#  set tock to parameter</span>
            <span class="c1"># tyme = self.tyme</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># allows enter to override completion state</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enter</span><span class="p">()</span>  <span class="c1"># doist.ready equivalent</span>

            <span class="c1">#recur context</span>
            <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">done</span> <span class="ow">or</span> <span class="n">always</span><span class="p">):</span>  <span class="c1"># recur context</span>
                <span class="n">tyme</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tock</span><span class="p">))</span>  <span class="c1"># yields .tock then waits for next send</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recur</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="n">tyme</span><span class="p">)</span>  <span class="c1"># equv of doist.once</span>

        <span class="k">except</span> <span class="ne">GeneratorExit</span><span class="p">:</span>  <span class="c1"># close context, forced exit due to .close</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>  <span class="c1"># abort context, forced exit due to uncaught exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">(</span><span class="n">ex</span><span class="o">=</span><span class="n">ex</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># clean context</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>

        <span class="k">finally</span><span class="p">:</span>  <span class="c1"># exit context, exit, unforced if normal exit of try, forced otherwise</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>  <span class="c1"># equiv of doist.do finally clause</span>

        <span class="c1"># return value of yield from or StopIteration.value indicates completion</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">done</span>  <span class="c1"># Only returns done state if normal return not close or abort raise</span></div>


<div class="viewcode-block" id="DoDoer.enter"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.DoDoer.enter">[docs]</a>    <span class="k">def</span> <span class="nf">enter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deeds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do &#39;enter&#39; context actions. Equivalent of Doist.ready()</span>

<span class="sd">        Returns deeds deque of triples (dog, retyme, index)  where:</span>
<span class="sd">            dog is generator</span>
<span class="sd">            retyme is tyme in seconds when next should run may be real or simulated</span>
<span class="sd">            index is position of associated doer in .doers list</span>

<span class="sd">        Calls each generator callable (function or method) in .doers to create</span>
<span class="sd">        each generator dog.</span>

<span class="sd">        Runs enter context of each dog by calling next(dog)</span>

<span class="sd">        Parameters:</span>
<span class="sd">            doers is list of generator method or function callables with attributes</span>
<span class="sd">                tock, done, and opts dict(). If not provided uses .doers.</span>
<span class="sd">                Parameterization here of doers enables some special cases.</span>
<span class="sd">                The normal case is to initialize in .__init__.</span>

<span class="sd">            deeds is deque of deed triples of form (dog, retyme, index).</span>
<span class="sd">                If not provided uses .deeds.</span>
<span class="sd">                Parameterization here of deeds enables some special cases.</span>
<span class="sd">                The normal case is to initialize in .__init__.</span>

<span class="sd">        In each deed the index must match offset of the doer in the doers list.</span>

<span class="sd">        See: https://stackoverflow.com/questions/40528867/setting-attributes-on-func</span>
<span class="sd">        For setting attributes on bound methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">doers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">doers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doers</span>
        <span class="k">if</span> <span class="n">deeds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">deeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deeds</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">doer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">doers</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">doer</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># None before enter. enter may set to False</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>   <span class="c1"># when using bound method for generator function</span>
                <span class="n">doer</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># None before enter. enter may set to False</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="n">doer</span><span class="o">.</span><span class="n">opts</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">doer</span><span class="p">,</span> <span class="s2">&quot;opts&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="p">{}</span>
            <span class="n">dog</span> <span class="o">=</span> <span class="n">doer</span><span class="p">(</span><span class="n">tymth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tymth</span><span class="p">,</span> <span class="n">tock</span><span class="o">=</span><span class="n">doer</span><span class="o">.</span><span class="n">tock</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">next</span><span class="p">(</span><span class="n">dog</span><span class="p">)</span>  <span class="c1"># run enter by advancing to first yield</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># don&#39;t append</span>
            <span class="n">deeds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tyme</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">deeds</span></div>


<div class="viewcode-block" id="DoDoer.recur"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.DoDoer.recur">[docs]</a>    <span class="k">def</span> <span class="nf">recur</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tyme</span><span class="p">,</span> <span class="n">doers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deeds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do &#39;recur&#39; context actions. Equivalent of Doist.once</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tyme is output of send fed to do yield, Doist feeds its .tyme</span>
<span class="sd">                because tymist is injected by doist or dodoer doing this dodoer</span>
<span class="sd">                self.tyme is same as tyme.</span>
<span class="sd">            doers is list of generator method or function callables with attributes</span>
<span class="sd">                tock, done, and opts dict(). If not provided uses .doers.</span>
<span class="sd">                Parameterization here of doers enables some special cases.</span>
<span class="sd">                The normal case is to initialize in .__init__.</span>
<span class="sd">            deeds is deque of deed triples of form (dog, retyme, index).</span>
<span class="sd">                If not provided uses .deeds.</span>
<span class="sd">                Parameterization here of deeds enables some special cases.</span>
<span class="sd">                The normal case is to initialize in .__init__.</span>

<span class="sd">        Returns completion state of recurrence actions.</span>
<span class="sd">           True means done False means continue</span>

<span class="sd">        Cycle once through deeds deque and update in place</span>

<span class="sd">        Each cycle checks all generators dogs in deeds deque and runs if retyme past.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">doers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">doers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doers</span>
        <span class="k">if</span> <span class="n">deeds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">deeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deeds</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">deeds</span><span class="p">)):</span>  <span class="c1"># iterate once over each deed</span>
            <span class="n">dog</span><span class="p">,</span> <span class="n">retyme</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">deeds</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>  <span class="c1"># pop it off</span>

            <span class="k">if</span> <span class="n">retyme</span> <span class="o">&lt;=</span> <span class="n">tyme</span><span class="p">:</span>  <span class="c1"># run it now</span>
                <span class="k">try</span><span class="p">:</span>  <span class="c1"># tock == 0.0 means re-run asap</span>
                    <span class="n">tock</span> <span class="o">=</span> <span class="n">dog</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">tyme</span><span class="p">)</span>  <span class="c1"># send tyme. yield tock</span>
                <span class="k">except</span> <span class="ne">StopIteration</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>  <span class="c1"># returned instead of yielded</span>
                    <span class="n">doer</span> <span class="o">=</span> <span class="n">doers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">doer</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="n">ex</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="kc">False</span>  <span class="c1"># assign done state</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                        <span class="n">doer</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="n">ex</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="kc">False</span>  <span class="c1"># assign done state</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># reappend for next pass</span>
                    <span class="k">if</span> <span class="n">tock</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># bare yield results None</span>
                        <span class="n">tock</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># # rerun asap when tock == 0.0</span>
                    <span class="n">deeds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dog</span><span class="p">,</span> <span class="n">retyme</span> <span class="o">+</span> <span class="n">tock</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>  <span class="c1"># tock may change during run</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># not retyme yet</span>
                <span class="n">deeds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dog</span><span class="p">,</span> <span class="n">retyme</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>  <span class="c1"># reappend for next pass</span>

        <span class="k">return</span> <span class="p">(</span><span class="ow">not</span> <span class="n">deeds</span><span class="p">)</span>  <span class="c1"># True if deeds deque is empty</span></div>


<div class="viewcode-block" id="DoDoer.exit"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.DoDoer.exit">[docs]</a>    <span class="k">def</span> <span class="nf">exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deeds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do &#39;exit&#39; context actions.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            doers is list of generator method or function callables with attributes</span>
<span class="sd">                tock, done, and opts dict(). If not provided uses .doers.</span>
<span class="sd">                Parameterization here of doers enables some special cases.</span>
<span class="sd">                The normal case is to initialize in .__init__.</span>
<span class="sd">            deeds is deque of deed triples of form (dog, retyme, index).</span>
<span class="sd">                If not provided uses .deeds.</span>
<span class="sd">                Parameterization here of deeds enables some special cases.</span>
<span class="sd">                The normal case is to initialize in .__init__.</span>

<span class="sd">        In each deed the index must match offset of the doer in the doers list.</span>

<span class="sd">        See: https://stackoverflow.com/questions/40528867/setting-attributes-on-func</span>
<span class="sd">        For setting attributes on bound methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">deeds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">deeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deeds</span>
        <span class="k">if</span> <span class="n">doers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">doers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doers</span>

        <span class="k">while</span><span class="p">(</span><span class="n">deeds</span><span class="p">):</span>  <span class="c1"># .close each remaining dog in deeds in reverse order</span>
            <span class="n">dog</span><span class="p">,</span> <span class="n">retime</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">deeds</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>  <span class="c1"># pop it off in reverse (right side)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tock</span> <span class="o">=</span> <span class="n">dog</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># force GeneratorExit</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># Hmm? Not supposed to happen!</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># set done state</span>
                <span class="n">doer</span> <span class="o">=</span> <span class="n">doers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">doer</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># forced close</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># when using bound method for generator function</span>
                    <span class="n">doer</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># forced close</span></div>


<div class="viewcode-block" id="DoDoer.extend"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.DoDoer.extend">[docs]</a>    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doers</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extend .doers list with doers. Ready deeds from doers and extend .doers</span>
<span class="sd">        and .deeds.  Edit deeds in place so not replace deque.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            doers is list of doers to add as extension.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">deeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter</span><span class="p">(</span><span class="n">doers</span><span class="o">=</span><span class="n">doers</span><span class="p">,</span> <span class="n">deeds</span><span class="o">=</span><span class="n">deque</span><span class="p">())</span>  <span class="c1"># provide fresh deeds</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doers</span><span class="p">)</span>  <span class="c1"># get offset of index for extending dogs</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">deeds</span><span class="p">)):</span>  <span class="c1"># iterate once over each deed</span>
            <span class="n">dog</span><span class="p">,</span> <span class="n">retyme</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">deeds</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="n">offset</span>
            <span class="n">deeds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dog</span><span class="p">,</span> <span class="n">retyme</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">doers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deeds</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">deeds</span><span class="p">)</span></div>


<div class="viewcode-block" id="DoDoer.remove"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.DoDoer.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doers</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove doers from .doers list and any associated deeds from .deeds deque.</span>
<span class="sd">        Force close removed deeds.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            doers is list of doers to remove.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rdoers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">doers</span><span class="p">)</span>  <span class="c1"># doers to remove, make copy since destructive</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># map indices for each doer as appears in .doers to rdoers</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># index in remove list</span>
        <span class="k">for</span> <span class="n">doer</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rdoers</span><span class="p">):</span>  <span class="c1"># make copy since inplace filter of rdoers</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">doer</span><span class="p">)</span>  <span class="c1"># make sure a member of .doers</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">rdoers</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">doer</span><span class="p">)</span>  <span class="c1"># not in .doers so ignore remove from rdoers</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">rdeeds</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>  <span class="c1"># fresh deque for deeds to remove</span>
        <span class="n">deeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deeds</span>  <span class="c1"># edit update self.deeds in place</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># reappended index of remaining (not removed) deed</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">deeds</span><span class="p">)):</span>  <span class="c1"># iterate once over each deed</span>
            <span class="n">dog</span><span class="p">,</span> <span class="n">retyme</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">deeds</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>  <span class="c1"># found deed to remove and close</span>
                <span class="n">rdeeds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dog</span><span class="p">,</span> <span class="n">retyme</span><span class="p">,</span> <span class="n">indices</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>  <span class="c1"># add to removal deque</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># keep deed do not remove and close</span>
                <span class="n">deeds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dog</span><span class="p">,</span> <span class="n">retyme</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>  <span class="c1"># reappend</span>
                <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">doer</span> <span class="ow">in</span> <span class="n">rdoers</span><span class="p">:</span>  <span class="c1"># update .doers to remove rdoers</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doers</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">doer</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">doers</span><span class="o">=</span><span class="n">rdoers</span><span class="p">,</span> <span class="n">deeds</span><span class="o">=</span><span class="n">rdeeds</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ServerDoer"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.ServerDoer">[docs]</a><span class="k">class</span> <span class="nc">ServerDoer</span><span class="p">(</span><span class="n">Doer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Basic TCP Server</span>

<span class="sd">    See Doer for inherited attributes, properties, and methods.</span>

<span class="sd">    Attributes:</span>
<span class="sd">       .server is TCP Server instance</span>

<span class="sd">    Properties:</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ServerDoer.__init__"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.ServerDoer.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server</span><span class="p">,</span> <span class="o">**</span><span class="n">kwa</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize</span>

<span class="sd">        Parameters:</span>
<span class="sd">           server is TCP Server instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ServerDoer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">server</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tymth</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">wind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tymth</span><span class="p">)</span></div>


<div class="viewcode-block" id="ServerDoer.wind"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.ServerDoer.wind">[docs]</a>    <span class="k">def</span> <span class="nf">wind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tymth</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inject new tymist.tymth as new ._tymth. Changes tymist.tyme base.</span>
<span class="sd">        Updates winds .tymer .tymth</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ServerDoer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">wind</span><span class="p">(</span><span class="n">tymth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">wind</span><span class="p">(</span><span class="n">tymth</span><span class="p">)</span></div>


<div class="viewcode-block" id="ServerDoer.enter"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.ServerDoer.enter">[docs]</a>    <span class="k">def</span> <span class="nf">enter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">reopen</span><span class="p">()</span></div>


<div class="viewcode-block" id="ServerDoer.recur"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.ServerDoer.recur">[docs]</a>    <span class="k">def</span> <span class="nf">recur</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tyme</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">service</span><span class="p">()</span></div>


<div class="viewcode-block" id="ServerDoer.exit"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.ServerDoer.exit">[docs]</a>    <span class="k">def</span> <span class="nf">exit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="EchoServerDoer"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.EchoServerDoer">[docs]</a><span class="k">class</span> <span class="nc">EchoServerDoer</span><span class="p">(</span><span class="n">ServerDoer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Echo TCP Server</span>
<span class="sd">    Just echoes back to client whatever it receives from client</span>

<span class="sd">    See Doer for inherited attributes, properties, and methods.</span>

<span class="sd">    Inherited Attributes:</span>
<span class="sd">        .server is TCP Server instance</span>


<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="EchoServerDoer.enter"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.EchoServerDoer.enter">[docs]</a>    <span class="k">def</span> <span class="nf">enter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">reopen</span><span class="p">()</span></div>


<div class="viewcode-block" id="EchoServerDoer.recur"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.EchoServerDoer.recur">[docs]</a>    <span class="k">def</span> <span class="nf">recur</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tyme</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">service</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ca</span><span class="p">,</span> <span class="n">ix</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">ixes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>  <span class="c1"># echo back</span>
            <span class="k">if</span> <span class="n">ix</span><span class="o">.</span><span class="n">rxbs</span><span class="p">:</span>
                <span class="n">ix</span><span class="o">.</span><span class="n">tx</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">ix</span><span class="o">.</span><span class="n">rxbs</span><span class="p">))</span>
                <span class="n">ix</span><span class="o">.</span><span class="n">clearRxbs</span><span class="p">()</span></div>


<div class="viewcode-block" id="EchoServerDoer.exit"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.EchoServerDoer.exit">[docs]</a>    <span class="k">def</span> <span class="nf">exit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="ClientDoer"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.ClientDoer">[docs]</a><span class="k">class</span> <span class="nc">ClientDoer</span><span class="p">(</span><span class="n">Doer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Basic TCP Client</span>

<span class="sd">    See Doer for inherited attributes, properties, and methods.</span>

<span class="sd">    Attributes:</span>
<span class="sd">       .client is TCP Client instance</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ClientDoer.__init__"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.ClientDoer.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="o">**</span><span class="n">kwa</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize instance.</span>

<span class="sd">        Parameters:</span>
<span class="sd">           client is TCP Client instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ClientDoer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tymth</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">wind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tymth</span><span class="p">)</span></div>


<div class="viewcode-block" id="ClientDoer.wind"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.ClientDoer.wind">[docs]</a>    <span class="k">def</span> <span class="nf">wind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tymth</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inject new tymist.tymth as new ._tymth. Changes tymist.tyme base.</span>
<span class="sd">        Updates winds .tymer .tymth</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ClientDoer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">wind</span><span class="p">(</span><span class="n">tymth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">wind</span><span class="p">(</span><span class="n">tymth</span><span class="p">)</span></div>


<div class="viewcode-block" id="ClientDoer.enter"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.ClientDoer.enter">[docs]</a>    <span class="k">def</span> <span class="nf">enter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">reopen</span><span class="p">()</span></div>


<div class="viewcode-block" id="ClientDoer.recur"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.ClientDoer.recur">[docs]</a>    <span class="k">def</span> <span class="nf">recur</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tyme</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">service</span><span class="p">()</span></div>


<div class="viewcode-block" id="ClientDoer.exit"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.ClientDoer.exit">[docs]</a>    <span class="k">def</span> <span class="nf">exit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="EchoConsoleDoer"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.EchoConsoleDoer">[docs]</a><span class="k">class</span> <span class="nc">EchoConsoleDoer</span><span class="p">(</span><span class="n">Doer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Basic Terminal Console IO to buffers. Echos input back to output</span>

<span class="sd">    To test in WingIde must configure Debug i/O to use external console</span>

<span class="sd">    See Doer for inherited attributes, properties, and methods.</span>

<span class="sd">    Attributes:</span>
<span class="sd">       .console is serial Console instance</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="EchoConsoleDoer.__init__"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.EchoConsoleDoer.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">console</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">txbs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwa</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize instance.</span>

<span class="sd">        Parameters:</span>
<span class="sd">           console is serial Console instance</span>
<span class="sd">           lines is deque of input bytes bytearrays of each line from console</span>
<span class="sd">           txbs is ouput bytes bytearray to send to console</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EchoConsoleDoer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span> <span class="o">=</span> <span class="n">console</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span> <span class="k">if</span> <span class="n">lines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">deque</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txbs</span> <span class="o">=</span> <span class="n">txbs</span> <span class="k">if</span> <span class="n">txbs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">bytearray</span><span class="p">()</span></div>


<div class="viewcode-block" id="EchoConsoleDoer.enter"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.EchoConsoleDoer.enter">[docs]</a>    <span class="k">def</span> <span class="nf">enter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">reopen</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txbs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Cmds: q=quit, h=help otherwise echoes.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txbs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Type cmd &amp; </span><span class="se">\n</span><span class="s2">: &quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="EchoConsoleDoer.recur"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.EchoConsoleDoer.recur">[docs]</a>    <span class="k">def</span> <span class="nf">recur</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tyme</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
            <span class="c1">#process line here</span>
            <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;q&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">txbs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Goodbye</span><span class="se">\n</span><span class="s2">.&quot;</span><span class="p">)</span>
                <span class="n">done</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1">#  all done so indicate exit</span>
                <span class="k">break</span>

            <span class="k">elif</span> <span class="n">line</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;h&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">txbs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Help: type q to quit or h for help.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">txbs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Echo: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">line</span> <span class="p">)</span>

            <span class="n">prompt</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">prompt</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">txbs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Type cmd &amp; </span><span class="se">\n</span><span class="s2">: &quot;</span><span class="p">)</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">txbs</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">txbs</span><span class="p">)</span>  <span class="c1">#  write</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">txbs</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>

        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">getLine</span><span class="p">()</span>  <span class="c1">#  read</span>
        <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">done</span>  <span class="c1"># keep going if done == False else ends</span></div>

<div class="viewcode-block" id="EchoConsoleDoer.exit"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.EchoConsoleDoer.exit">[docs]</a>    <span class="k">def</span> <span class="nf">exit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="bareDo"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.bareDo">[docs]</a><span class="k">def</span> <span class="nf">bareDo</span><span class="p">(</span><span class="n">tymth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tock</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bare bones generator function template as example of generator function</span>
<span class="sd">    suitable for use with either doify wrapper or doize decorator.</span>
<span class="sd">    Make copy and rename for given application.</span>
<span class="sd">    Calling copied renamed function returns basic generator.</span>
<span class="sd">    Wrapping copied renamed function with doify returns yet unique wrapped copy</span>
<span class="sd">    with unique values of injected attributes and  parameters and further</span>
<span class="sd">    renamed by wrapper.</span>
<span class="sd">    Decorating copied renamed function with doize returns singleton with injected</span>
<span class="sd">    parameter values.</span>

<span class="sd">    Injected Attributes:</span>
<span class="sd">        g.tock = tock  # default tock attributes</span>
<span class="sd">        g.done = None  # default done state</span>
<span class="sd">        g.opts</span>

<span class="sd">    Parameters:</span>
<span class="sd">        tymth is injected function wrapper closure returned by .tymen() of</span>
<span class="sd">                Tymist instance. Calling tymth() returns associated Tymist .tyme.</span>
<span class="sd">        tock is injected initial tock value</span>
<span class="sd">        opts is dict of injected optional additional parameters</span>

<span class="sd">    The function comments show where the 6 equivalent contexts are performed</span>
<span class="sd">    enter, recur, clean, exit, (unforced) close, abort (forced)</span>
<span class="sd">    So context order may be:</span>
<span class="sd">    enter, recur, clean, exit</span>
<span class="sd">    enter, recur, close, exit</span>
<span class="sd">    enter, recur, abort, exit</span>
<span class="sd">    enter, abort, exit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># enter context</span>
        <span class="c1"># tyme = tymth()</span>
        <span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>  <span class="c1"># recur context</span>
            <span class="n">tyme</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span> <span class="p">(</span><span class="n">tock</span><span class="p">))</span>  <span class="c1"># yields tock then waits for next send</span>
            <span class="c1">#  do stuff repeately in while loop</span>
            <span class="n">done</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># means ready to exit while loop</span>

    <span class="k">except</span> <span class="ne">GeneratorExit</span><span class="p">:</span>  <span class="c1"># close context upon Doist thrown .close to force early exit.</span>
        <span class="k">pass</span>  <span class="c1"># do forced close clean up here</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>  <span class="c1"># abort context, forced exit due to uncaught exception</span>
        <span class="k">pass</span>  <span class="c1"># do unexpected exception clean up here</span>
        <span class="k">raise</span> <span class="n">ex</span>  <span class="c1"># always re-raise exception after any exception specific actions</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># clean context, clean exit processing when not (close or abort)</span>
        <span class="k">pass</span>  <span class="c1"># do clean exit only clean up here</span>

    <span class="k">finally</span><span class="p">:</span>  <span class="c1"># exit context,  all exits both forced and unforced come through here</span>
        <span class="k">pass</span>  <span class="c1"># manditory clean up here</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">done</span><span class="p">)</span>  <span class="c1"># returned value on final yield from, or yielded ex.value of StopIteration</span></div>


<div class="viewcode-block" id="ExDoer"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.ExDoer">[docs]</a><span class="k">class</span> <span class="nc">ExDoer</span><span class="p">(</span><span class="n">Doer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ExDoer is example Doer for testing and demonstration</span>
<span class="sd">    Supports introspection with methods to record sends and yields</span>

<span class="sd">    See Doer for inherited attributes, properties, and methods.</span>

<span class="sd">    Attributes:</span>
<span class="sd">       .states is list of State namedtuples (tyme, context, feed, count)</span>
<span class="sd">       .count is iteration count</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ExDoer.__init__"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.ExDoer.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwa</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ExDoer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="ExDoer.enter"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.ExDoer.enter">[docs]</a>    <span class="k">def</span> <span class="nf">enter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tyme</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s2">&quot;enter&quot;</span><span class="p">,</span>
                                 <span class="n">feed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tyme</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">))</span></div>

<div class="viewcode-block" id="ExDoer.recur"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.ExDoer.recur">[docs]</a>    <span class="k">def</span> <span class="nf">recur</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tyme</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tyme</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s2">&quot;recur&quot;</span><span class="p">,</span>
                                 <span class="n">feed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tyme</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># complete</span>
        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># incomplete</span></div>

<div class="viewcode-block" id="ExDoer.exit"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.ExDoer.exit">[docs]</a>    <span class="k">def</span> <span class="nf">exit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tyme</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;exit&#39;</span><span class="p">,</span>
                                 <span class="n">feed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">))</span></div>

<div class="viewcode-block" id="ExDoer.close"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.ExDoer.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tyme</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">,</span>
                                 <span class="n">feed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">))</span></div>

<div class="viewcode-block" id="ExDoer.abort"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.ExDoer.abort">[docs]</a>    <span class="k">def</span> <span class="nf">abort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tyme</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;abort&#39;</span><span class="p">,</span>
                                 <span class="n">feed</span><span class="o">=</span><span class="n">ex</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">))</span></div></div>




<div class="viewcode-block" id="doifyExDo"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.doifyExDo">[docs]</a><span class="k">def</span> <span class="nf">doifyExDo</span><span class="p">(</span><span class="n">tymth</span><span class="p">,</span> <span class="n">tock</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">states</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Example generator function for testing and demonstration.</span>
<span class="sd">    Example non-class based generator for use with doify wrapper.</span>
<span class="sd">    Calling this function returns generator.</span>
<span class="sd">    Wrapping this function with doify returns copy with unique attributes</span>

<span class="sd">    Parameters:</span>
<span class="sd">        tymth is injected function wrapper closure returned by .tymen() of</span>
<span class="sd">                Tymist instance. Calling tymth() returns associated Tymist .tyme.</span>
<span class="sd">        tock is injected initial tock value</span>
<span class="sd">        states is list of State namedtuples (tyme, context, feed, count)</span>
<span class="sd">        opts is dict of injected optional additional parameters</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tyme</span> <span class="o">=</span> <span class="n">tymth</span><span class="p">()</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">states</span> <span class="o">=</span> <span class="n">states</span> <span class="k">if</span> <span class="n">states</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># enter context</span>
        <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="n">tymth</span><span class="p">(),</span> <span class="n">context</span><span class="o">=</span><span class="s2">&quot;enter&quot;</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="n">tyme</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">))</span>
        <span class="k">while</span> <span class="p">(</span><span class="kc">True</span><span class="p">):</span>  <span class="c1"># recur context</span>
            <span class="n">tyme</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span> <span class="p">(</span><span class="n">tock</span><span class="p">))</span>  <span class="c1"># yields tock then waits for next send</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="n">tymth</span><span class="p">(),</span> <span class="n">context</span><span class="o">=</span><span class="s2">&quot;recur&quot;</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="n">tyme</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">break</span>  <span class="c1"># normal exit</span>

    <span class="k">except</span> <span class="ne">GeneratorExit</span><span class="p">:</span>  <span class="c1"># close context, forced exit due to .close</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="n">tymth</span><span class="p">(),</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">))</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>  <span class="c1"># abort context, forced exit due to uncaught exception</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="n">tymth</span><span class="p">(),</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;abort&#39;</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="n">ex</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">ex</span>

    <span class="k">finally</span><span class="p">:</span>  <span class="c1"># exit context,  unforced exit due to normal exit of try</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="n">tymth</span><span class="p">(),</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;exit&#39;</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">(</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># return value of yield from, or yield ex.value of StopIteration</span></div>


<span class="nd">@doize</span><span class="p">(</span><span class="n">tock</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">states</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<div class="viewcode-block" id="doizeExDo"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.doizeExDo">[docs]</a><span class="k">def</span> <span class="nf">doizeExDo</span><span class="p">(</span><span class="n">tymth</span><span class="p">,</span> <span class="n">tock</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">states</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Example decorated generator function for use with doize decorator.</span>
<span class="sd">    Example non-class based generator</span>
<span class="sd">    Calling this function returns generator</span>

<span class="sd">    Parameters:</span>
<span class="sd">        tymth is injected function wrapper closure returned by .tymen() of</span>
<span class="sd">            Tymist instance. Calling tymth() returns associated Tymist .tyme.</span>
<span class="sd">            tock is injected initial tock value</span>
<span class="sd">            states is list of State namedtuples (tyme, context, feed, count)</span>
<span class="sd">            opts is dict of injected optional additional parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tyme</span> <span class="o">=</span> <span class="n">tymth</span><span class="p">()</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">states</span> <span class="o">=</span> <span class="n">states</span> <span class="k">if</span> <span class="n">states</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># enter context</span>
        <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="n">tymth</span><span class="p">(),</span> <span class="n">context</span><span class="o">=</span><span class="s2">&quot;enter&quot;</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="n">tyme</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">))</span>
        <span class="k">while</span> <span class="p">(</span><span class="kc">True</span><span class="p">):</span>  <span class="c1"># recur context</span>
            <span class="n">tyme</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span> <span class="p">(</span><span class="n">tock</span><span class="p">))</span>  <span class="c1"># yields tock then waits for next send</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="n">tymth</span><span class="p">(),</span> <span class="n">context</span><span class="o">=</span><span class="s2">&quot;recur&quot;</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="n">tyme</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">break</span>  <span class="c1"># normal exit</span>

    <span class="k">except</span> <span class="ne">GeneratorExit</span><span class="p">:</span>  <span class="c1"># close context, forced exit due to .close</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="n">tymth</span><span class="p">(),</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">))</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>  <span class="c1"># abort context, forced exit due to uncaught exception</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="n">tymth</span><span class="p">(),</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;abort&#39;</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="n">ex</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">ex</span>

    <span class="k">finally</span><span class="p">:</span>  <span class="c1"># exit context,  unforced exit due to normal exit of try</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="n">tymth</span><span class="p">(),</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;exit&#39;</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">(</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># return value of yield from, or yield ex.value of StopIteration</span></div>




<span class="c1">#  for testing purposes</span>
<div class="viewcode-block" id="TryDoer"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.TryDoer">[docs]</a><span class="k">class</span> <span class="nc">TryDoer</span><span class="p">(</span><span class="n">Doer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TryDoer supports testing with methods to record sends and yields</span>

<span class="sd">    Inherited Attributes:</span>
<span class="sd">        .done is Boolean completion state:</span>
<span class="sd">            True means completed</span>
<span class="sd">            Otherwise incomplete. Incompletion maybe due to close or abort.</span>

<span class="sd">    Attributes:</span>
<span class="sd">       .states is list of State namedtuples (tyme, context, feed, count)</span>
<span class="sd">       .count is context count</span>
<span class="sd">       .stop is stop count where doer completes</span>

<span class="sd">    Inherited Properties:</span>
<span class="sd">        .tyme is float relative cycle time of associated Tymist .tyme obtained</span>
<span class="sd">            via injected .tymth function wrapper closure.</span>
<span class="sd">        .tymth is function wrapper closure returned by Tymist .tymeth() method.</span>
<span class="sd">            When .tymth is called it returns associated Tymist .tyme.</span>
<span class="sd">            .tymth provides injected dependency on Tymist tyme base.</span>
<span class="sd">        .tock is float, desired time in seconds between runs or until next run,</span>
<span class="sd">                 non negative, zero means run asap</span>

<span class="sd">    Properties:</span>

<span class="sd">    Methods:</span>
<span class="sd">        .wind  injects ._tymth dependency from associated Tymist to get its .tyme</span>
<span class="sd">        .__call__ makes instance callable</span>
<span class="sd">            Appears as generator function that returns generator</span>
<span class="sd">        .do is generator method that returns generator</span>
<span class="sd">        .enter is enter context action method</span>
<span class="sd">        .recur is recur context action method or generator method</span>
<span class="sd">        .exit is exit context method</span>
<span class="sd">        .close is close context method</span>
<span class="sd">        .abort is abort context method</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TryDoer.__init__"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.TryDoer.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="o">**</span><span class="n">kwa</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize instance.</span>
<span class="sd">        Inherited Parameters:</span>
<span class="sd">           tymist is Tymist instance</span>
<span class="sd">           tock is float seconds initial value of .tock</span>
<span class="sd">        Parameters:</span>
<span class="sd">           stop is count when complete</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TryDoer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span></div>

<div class="viewcode-block" id="TryDoer.enter"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.TryDoer.enter">[docs]</a>    <span class="k">def</span> <span class="nf">enter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">feed</span> <span class="o">=</span> <span class="s2">&quot;Default&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tyme</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s2">&quot;enter&quot;</span><span class="p">,</span>
                                 <span class="n">feed</span><span class="o">=</span><span class="n">feed</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">))</span></div>

<div class="viewcode-block" id="TryDoer.recur"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.TryDoer.recur">[docs]</a>    <span class="k">def</span> <span class="nf">recur</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tyme</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tyme</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s2">&quot;recur&quot;</span><span class="p">,</span>
                                 <span class="n">feed</span><span class="o">=</span><span class="n">tyme</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># complete</span>
        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># incomplete</span></div>

<div class="viewcode-block" id="TryDoer.exit"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.TryDoer.exit">[docs]</a>    <span class="k">def</span> <span class="nf">exit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tyme</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;exit&#39;</span><span class="p">,</span>
                                 <span class="n">feed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">))</span></div>

<div class="viewcode-block" id="TryDoer.close"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.TryDoer.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tyme</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">,</span>
                                 <span class="n">feed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">))</span></div>

<div class="viewcode-block" id="TryDoer.abort"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.TryDoer.abort">[docs]</a>    <span class="k">def</span> <span class="nf">abort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tyme</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;abort&#39;</span><span class="p">,</span>
                                 <span class="n">feed</span><span class="o">=</span><span class="n">ex</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">))</span></div></div>


<span class="c1">#  for testing purposes</span>
<span class="nd">@doize</span><span class="p">()</span>
<div class="viewcode-block" id="tryDo"><a class="viewcode-back" href="../../../hio.base.html#hio.base.doing.tryDo">[docs]</a><span class="k">def</span> <span class="nf">tryDo</span><span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">tymth</span><span class="p">,</span> <span class="n">tock</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generator function test example non-class based generator.</span>
<span class="sd">    Calling this function returns generator</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">feed</span> <span class="o">=</span> <span class="s2">&quot;Default&quot;</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># enter context</span>

        <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="n">tymth</span><span class="p">(),</span> <span class="n">context</span><span class="o">=</span><span class="s2">&quot;enter&quot;</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="n">feed</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">))</span>
        <span class="k">while</span> <span class="p">(</span><span class="kc">True</span><span class="p">):</span>  <span class="c1"># recur context</span>
            <span class="n">feed</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span> <span class="p">(</span><span class="n">count</span><span class="p">))</span>  <span class="c1"># yields tock then waits for next send</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="n">tymth</span><span class="p">(),</span> <span class="n">context</span><span class="o">=</span><span class="s2">&quot;recur&quot;</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="n">feed</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">count</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">break</span>  <span class="c1"># normal exit</span>

    <span class="k">except</span> <span class="ne">GeneratorExit</span><span class="p">:</span>  <span class="c1"># close context, forced exit due to .close</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="n">tymth</span><span class="p">(),</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="n">feed</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">))</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># abort context, forced exit due to uncaught exception</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="n">tymth</span><span class="p">(),</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;abort&#39;</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="n">feed</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">))</span>
        <span class="k">raise</span>

    <span class="k">finally</span><span class="p">:</span>  <span class="c1"># exit context,  unforced exit due to normal exit of try</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">tyme</span><span class="o">=</span><span class="n">tymth</span><span class="p">(),</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;exit&#39;</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="n">feed</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">(</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># return value of yield from, or yield ex.value of StopIteration</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020-2021, Samuel M. Smith.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>